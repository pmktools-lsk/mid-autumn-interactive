<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mid-Autumn Interactive</title>
  <style>
    body { display: flex; background:#0f1b2e; color:white; margin:0; font-family:Arial; }
    .video-container { flex: 2; padding:10px; }
    .controls { margin-top:10px; }
    video { width:100%; max-height:70vh; object-fit:contain; background:black; }
    .sidebar { flex: 1; padding:10px; overflow-y:auto; height:100vh; }
    .subtitle { padding:5px; border-bottom:1px solid #333; }
    .active { background:#223d66; }
    .quiz-box { margin-top:20px; padding:10px; border:1px solid #666; background:#1b2a3d; }
    .quiz-box input { padding:5px; }
    .quiz-box button { padding:5px; margin-left:5px; }
  </style>
</head>
<body>
  <div class="video-container">
    <h3>故事影片</h3>
    <video id="video" controls>
      <source src="story.mov" type="video/mp4">
      Your browser does not support video.
    </video>
    <div class="controls">
      <button onclick="prevLine()">⏮ 上一句</button>
      <button onclick="togglePlay()">▶️ 播放 / 暫停</button>
      <button onclick="nextLine()">⏭ 下一句</button>
      <button onclick="repeatLine()">🔁 重複本句</button>
      <button onclick="fitScreen()">🖼️ 適應畫面</button>
    </div>
  </div>

  <div class="sidebar">
    <h3>字幕對照 / 小測驗</h3>
    <div id="subtitleList"></div>
    <div class="quiz-box">
      <p id="quizQuestion">Press "出題" 開始測驗</p>
      <input type="text" id="quizAnswer" placeholder="輸入答案">
      <button onclick="checkAnswer()">送出</button>
      <button onclick="newQuiz()">出題</button>
      <p id="quizResult"></p>
    </div>
  </div>

<script>
const subtitles = [
  { start: 0, end: 4, en: "The Mid-Autumn Festival falls on the fifteenth day of the eighth month in the Chinese lunar calendar.", zh:"中秋節在農曆八月十五這一天。" },
  { start: 4, end: 9, en: "It is a time to admire the big, round moon.", zh:"這是抬頭賞圓月的時刻。" },
  { start: 9, end: 14, en: "This has been a special day in China for a very long time.", zh:"在中國，這是一個流傳已久的特別節日。" }
];

const video = document.getElementById("video");
const subtitleList = document.getElementById("subtitleList");

subtitles.forEach((s,i)=>{
  let div=document.createElement("div");
  div.className="subtitle";
  div.id="sub"+i;
  div.innerHTML=`<b>${formatTime(s.start)}</b> ${s.en}<br><span style="color:#ccc">${s.zh}</span>`;
  subtitleList.appendChild(div);
});

video.addEventListener("timeupdate",()=>{
  let t=video.currentTime;
  subtitles.forEach((s,i)=>{
    let line=document.getElementById("sub"+i);
    if(t>=s.start && t<s.end){
      line.classList.add("active");
      line.scrollIntoView({behavior:"smooth", block:"center"});
    }else{
      line.classList.remove("active");
    }
  });
});

// --- 控制 ---
function prevLine(){ seekTo(-1); }
function nextLine(){ seekTo(1); }
function seekTo(offset){
  let t=video.currentTime;
  let idx=subtitles.findIndex(s=>t>=s.start && t<s.end);
  if(idx>=0){
    let newIdx=Math.min(subtitles.length-1, Math.max(0, idx+offset));
    video.currentTime=subtitles[newIdx].start;
  }
}
function repeatLine(){
  let t=video.currentTime;
  let idx=subtitles.findIndex(s=>t>=s.start && t<s.end);
  if(idx>=0) video.currentTime=subtitles[idx].start;
}
function togglePlay(){ video.paused?video.play():video.pause(); }
function fitScreen(){ video.style.objectFit="contain"; }

// --- 小測驗 (填空) ---
let currentQuiz=null;

function newQuiz(){
  let s=subtitles[Math.floor(Math.random()*subtitles.length)];
  let words=s.en.split(" ");
  let blankIdx=Math.floor(Math.random()*words.length);
  currentQuiz={answer:words[blankIdx].replace(/[^a-zA-Z]/g,"")};
  words[blankIdx]="_____";
  document.getElementById("quizQuestion").innerText=words.join(" ");
  document.getElementById("quizResult").innerText="";
  document.getElementById("quizAnswer").value="";
}

function checkAnswer(){
  let ans=document.getElementById("quizAnswer").value.trim();
  if(!currentQuiz) return;
  if(ans.toLowerCase()===currentQuiz.answer.toLowerCase()){
    document.getElementById("quizResult").innerText="✅ 正確!";
  }else{
    document.getElementById("quizResult").innerText="❌ 錯誤, 正確答案: "+currentQuiz.answer;
  }
}

function formatTime(sec){
  let m=Math.floor(sec/60);
  let s=Math.floor(sec%60).toString().padStart(2,"0");
  return `${m}:${s}`;
}
</script>
</body>
</html>




