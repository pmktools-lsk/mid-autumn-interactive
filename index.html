<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>çœ‹æ•…äº‹å­¸è‹±èªï½œäº’å‹•ç‰ˆï¼ˆå–®æª”éƒ¨ç½²ï¼‰</title>
<meta name="description" content="é€å¥è·³æ’­ã€é›™èªå­—å¹•ã€å–®å­—æç¤ºã€å°æ¸¬é©—ã€‚">
<style>
  :root{--bg:#0f172a;--panel:#111827;--muted:#9ca3af;--accent:#22d3ee;--accent2:#a78bfa;--danger:#ef4444;}
  html,body{height:100%;margin:0;background:#0b1220;color:#e5e7eb;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans TC","PingFang TC","Microsoft JhengHei",sans-serif}
  .app{display:grid;grid-template-columns:1.15fr 1fr;gap:14px;max-width:1280px;margin:0 auto;padding:14px;height:100vh;box-sizing:border-box}
  @media (max-width: 900px){.app{grid-template-columns:1fr;grid-auto-rows:minmax(0,1fr)}}
  .left,.right{background:#111827;border-radius:14px;display:flex;flex-direction:column;min-height:0}
  .left header,.right header{padding:10px 14px;border-bottom:1px solid rgba(255,255,255,.06);display:flex;align-items:center;gap:10px}
  .left header h1,.right header h2{margin:0;font-size:16px;font-weight:600}
  .player{position:relative;display:flex;flex-direction:column;gap:8px;padding:14px;height:100%;box-sizing:border-box}
  video{width:100%;max-height:65vh;border-radius:10px;background:#000}
  .controls{display:flex;flex-wrap:wrap;gap:8px}
  .btn{background:#1f2937;border:1px solid rgba(255,255,255,.1);padding:8px 10px;border-radius:10px;color:#e5e7eb;cursor:pointer}
  .btn:hover{border-color:rgba(255,255,255,.25)}
  .btn[aria-pressed="true"]{outline:2px solid var(--accent)}
  .speed{margin-left:auto;display:flex;align-items:center;gap:6px}
  .bar{height:4px;background:#111a36;border-radius:999px;overflow:hidden}
  .bar > span{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--accent),var(--accent2))}
  .banner{display:none;margin:-4px 14px 8px;padding:10px 12px;border:1px solid rgba(239,68,68,.4);background:rgba(239,68,68,.12);color:#fecaca;border-radius:10px}

  .right main{display:grid;grid-template-rows:auto auto 1fr;gap:10px;padding:14px;overflow:hidden}
  .tools{display:flex;gap:8px}
  .now{background:#0b1022;border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:12px}
  .now .en{font-size:20px;font-weight:700}
  .chip{background:#1f2541;border:1px solid rgba(255,255,255,.08);padding:6px 10px;border-radius:999px;font-size:12px;margin-right:6px}
  .hidden{display:none!important}

  .list{overflow:auto;border:1px solid rgba(255,255,255,.06);border-radius:12px}
  .row{display:grid;grid-template-columns:48px 74px 1fr;gap:10px;padding:10px 12px;border-bottom:1px solid rgba(255,255,255,.06);cursor:pointer}
  .row:hover{background:#12193a}
  .row.active{background:linear-gradient(90deg, rgba(34,211,238,.18), rgba(167,139,250,.12));}
  .idx{color:#9ca3af;text-align:right}
  .time{color:#9ca3af;font-variant-numeric:tabular-nums}
  .enline{font-weight:700;line-height:1.25}
  .zhline{opacity:.85}
  .compact .row{padding:6px 10px}
  .compact .enline{line-height:1.1}
</style>
</head>
<body>
  <div class="app">
    <section class="left">
      <header>
        <h1>æ•…äº‹å½±ç‰‡</h1>
        <input type="file" id="fileVideo" accept="video/*" class="btn" />
        <span class="muted">æœªè‡ªå‹•è¼‰å…¥æ™‚è«‹æŒ‰ã€Œé¸æ“‡æª”æ¡ˆã€â†’ é¸å– (story.mov / story.mp4)ã€‚</span>
      </header>
      <div id="errorBanner" class="banner"></div>
      <div class="player">
        <video id="vid" controls crossorigin="anonymous"></video>
        <div class="bar"><span id="prog"></span></div>
        <div class="controls">
          <button class="btn" id="prev">â® ä¸Šä¸€å¥</button>
          <button class="btn" id="toggle">â–¶ï¸/â¸ æ’­æ”¾</button>
          <button class="btn" id="next">â­ ä¸‹ä¸€å¥</button>
          <button class="btn" id="replay">ğŸ” é‡è¤‡æœ¬å¥</button>
          <button class="btn" id="autoPause" aria-pressed="false">ğŸ§© é€å¥è‡ªå‹•æš«åœ</button>
          <button class="btn" id="wholeLoop" aria-pressed="false">ğŸ”‚ æ•´æ®µå¾ªç’°</button>
          <button class="btn" id="abOnClick" aria-pressed="true">ğŸ…°ï¸ğŸ…±ï¸ é»å¥å³å¾ªç’°</button>
          <button class="btn" id="clearLoop">â¹ å–æ¶ˆå¾ªç’°</button>
          <label class="speed">é€Ÿåº¦
            <input type="range" min="0.5" max="1.25" step="0.05" value="1" id="rate" />
            <span id="rateVal">1.00Ã—</span>
          </label>
        </div>
      </div>
    </section>

    <section class="right">
      <header>
        <h2>å­—å¹•å°ç…§ / å°æ¸¬é©—</h2>
        <div class="tools">
          <button class="btn" id="tabSub" aria-pressed="true">ğŸ“œ å­—å¹•åˆ—è¡¨</button>
          <button class="btn" id="tabQuiz" aria-pressed="false">âœï¸ å°æ¸¬é©—</button>
          <button class="btn" id="toggleCompact" aria-pressed="false">ç·Šæ¹Šæ¨¡å¼</button>
        </div>
      </header>
      <main id="mainRight">
        <div id="now" class="now">
          <div class="en" id="nowEn">â€”</div>
          <div class="zh" id="nowZh">â€”</div>
          <div id="nowVocab"></div>
        </div>

        <div id="quizBox" class="hidden">
          <div id="quizQ"></div>
          <div id="quizChoices" style="margin:8px 0;"></div>
          <input id="quizInput" class="hidden" placeholder="Type your answer" />
          <div style="display:flex;gap:8px;margin-top:8px">
            <button class="btn" id="quizCheck">æª¢æŸ¥</button>
            <button class="btn" id="quizNext">ä¸‹ä¸€é¡Œ</button>
            <span id="quizMsg" class="muted"></span>
          </div>
        </div>

        <div id="list" class="list"></div>
      </main>
    </section>
  </div>

<script>
(function(){
  // ====== 1) å…§å»ºå­—å¹•ç¨¿ï¼ˆå®Œæ•´ 22 å¥ï¼‰ ======
  const CUES = [
    {start:0.0,end:4.5,en:"The Mid-Autumn Festival falls on the fifteenth day of the eighth month in the Chinese lunar calendar.",zh:"ä¸­ç§‹ç¯€åœ¨è¾²æ›†å…«æœˆåäº”é€™ä¸€å¤©ã€‚",vocab:[{w:"lunar calendar",m:"è¾²æ›†"}]},
    {start:4.8,end:9.3,en:"It is a time to admire the big, round moon.",zh:"é€™æ˜¯æŠ¬é ­è³åœ“æœˆçš„æ™‚åˆ»ã€‚",vocab:[{w:"admire",m:"æ¬£è³"},{w:"moon",m:"æœˆäº®"}]},
    {start:9.6,end:14.1,en:"This has been a special day in China for a very long time.",zh:"åœ¨ä¸­åœ‹ï¼Œé€™æ˜¯ä¸€å€‹æµå‚³å·²ä¹…çš„ç‰¹åˆ¥ç¯€æ—¥ã€‚"},
    {start:14.4,end:18.9,en:"Long ago, there were ten suns in the sky.",zh:"å¾ˆä¹…ä»¥å‰ï¼Œå¤©ç©ºä¸­æ›¾ç¶“åŒæ™‚å‡ºç¾åå€‹å¤ªé™½ã€‚"},
    {start:19.2,end:23.7,en:"It was unbearably hot, and people suffered.",zh:"å¤©æ°£ç‚ç†±é›£è€ï¼Œäººå€‘å‚™å—ç…ç†¬ã€‚"},
    {start:24.0,end:28.5,en:"A brave archer named Hou Yi helped them.",zh:"ä¸€ä½å‹‡æ•¢çš„ç¥å°„æ‰‹åç¾¿å‡ºæ‰‹ç›¸æ•‘ã€‚",vocab:[{w:"archer",m:"å¼“ç®­æ‰‹"}]},
    {start:28.8,end:33.3,en:"He climbed a tall mountain and shot down nine suns with his strong bow.",zh:"ä»–ç™»ä¸Šé«˜å±±ï¼Œæ‹‰é–‹å¼·å¼“ï¼Œå°„ä¸‹äº†ä¹å€‹å¤ªé™½ã€‚",vocab:[{w:"bow",m:"å¼“"}]},
    {start:33.6,end:38.1,en:"Everyone loved Hou Yi for saving them.",zh:"äººå€‘æ„Ÿæ¿€åç¾¿çš„æ‹¯æ•‘ã€‚"},
    {start:38.4,end:42.9,en:"Hou Yi had a kind and beautiful wife named Changâ€™e, and they were very happy.",zh:"åç¾¿çš„å¦»å­åå«å«¦å¨¥ï¼Œå–„è‰¯ç¾éº—ï¼Œå¤«å¦»å€†å¹¸ç¦ç¾æ»¿ã€‚"},
    {start:43.2,end:47.7,en:"One day, Hou Yi met the Queen Mother of the West, who gave him a special elixir.",zh:"æœ‰ä¸€å¤©ï¼Œåç¾¿é‡è¦‹è¥¿ç‹æ¯ï¼Œå°æ–¹è´ˆäºˆä»–ä¸€é¡†ä»™ä¸¹ã€‚",vocab:[{w:"elixir",m:"ä»™ä¸¹"}]},
    {start:48.0,end:52.5,en:"This elixir could grant immortality.",zh:"é€™é¡†ä»™ä¸¹èƒ½ä½¿äººé•·ç”Ÿä¸æ­»ã€‚",vocab:[{w:"immortality",m:"é•·ç”Ÿä¸æ­»"}]},
    {start:52.8,end:57.3,en:"Because Hou Yi loved his wife, he did not take it and gave it to Changâ€™e to keep safe.",zh:"åç¾¿å› ç‚ºæ„›å¦»ä¾¿æ²’æœ‰æœä¸‹ï¼ŒæŠŠä»™ä¸¹äº¤çµ¦å«¦å¨¥ä¿ç®¡ã€‚"},
    {start:57.6,end:62.1,en:"A wicked man named Peng Meng learned about the elixir and wanted it for himself.",zh:"å£äººé€¢è’™å¾—çŸ¥æ­¤äº‹ï¼Œä¼åœ–å¥ªå–ä»™ä¸¹ã€‚"},
    {start:62.4,end:66.9,en:"When Hou Yi was away, Peng Meng came to their home and threatened Changâ€™e.",zh:"è¶åç¾¿å¤–å‡ºæ™‚ï¼Œé€¢è’™é—–å…¥å®¶ä¸­å¨é€¼å«¦å¨¥ã€‚"},
    {start:67.2,end:71.7,en:"Knowing she could not fight him, Changâ€™e quickly swallowed the elixir.",zh:"å«¦å¨¥è‡ªçŸ¥ç„¡åŠ›æŠµæŠ—ï¼Œæƒ…æ€¥ä¹‹ä¸‹åä¸‹ä»™ä¸¹ã€‚"},
    {start:72.0,end:76.5,en:"At once, she felt light and floated up into the sky until she reached the moon.",zh:"å¥¹ç«‹åˆ»è¦ºå¾—èº«é«”è®Šå¾—è¼•ç›ˆï¼Œå†‰å†‰å‡ç©ºï¼Œæœ€å¾Œä¾†åˆ°æœˆå®®ã€‚"},
    {start:76.8,end:81.3,en:"When Hou Yi learned what had happened, he was heartbroken.",zh:"åç¾¿å¾—çŸ¥æ­¤äº‹å¾Œï¼Œæ‚²ç—›ä¸å·²ã€‚"},
    {start:81.6,end:86.1,en:"He set out Changâ€™eâ€™s favorite foods to share with her from afar.",zh:"ä»–æ“ºä¸Šå«¦å¨¥æ„›åƒçš„é£Ÿç‰©ï¼Œé™ç¥­ç›¸æ€ã€‚"},
    {start:86.4,end:90.9,en:"The villagers also offered food and prayed to Changâ€™e for blessings.",zh:"æ‘æ°‘å€‘ä¹Ÿä¾›ä¸Šä½³é¤šï¼Œå‘å«¦å¨¥ç¥ˆæ±‚åº‡ä½‘ã€‚",vocab:[{w:"pray",m:"ç¥ˆç¦±"},{w:"blessings",m:"åº‡ä½‘"}]},
    {start:91.2,end:95.7,en:"Today, people celebrate the Mid-Autumn Festival by moon-gazing and eating mooncakes.",zh:"å¦‚ä»Šï¼Œäººå€‘ä»¥è³æœˆã€åƒæœˆé¤…ä¾†æ…¶ç¥ä¸­ç§‹ã€‚",vocab:[{w:"mooncake",m:"æœˆé¤…"}]},
    {start:96.0,end:100.5,en:"The festival is a time for families to be together and share happiness.",zh:"é€™æ˜¯ä¸€å€‹é—”å®¶åœ˜åœ“ã€å…±äº«æ­¡æ¨‚çš„ç¯€æ—¥ã€‚"}
  ].sort((a,b)=>a.start-b.start);

  // ====== 2) å°æ¸¬é©—é¡Œåº« ======
  const QUIZ = [
    {type:"mcq",q:"What day does the Mid-Autumn Festival fall on in the lunar calendar?",choices:["The 15th day of the 8th month","The 1st day of the 1st month","The last day of the year","The 10th day of the 10th month"],a:0,ex:"It falls on the 15th day of the 8th lunar month."},
    {type:"mcq",q:"Who shot down nine suns?",choices:["Changâ€™e","Hou Yi","Peng Meng","The Queen Mother of the West"],a:1,ex:"Hou Yi climbed a mountain and shot down nine suns."},
    {type:"mcq",q:"What did the Queen Mother of the West give to Hou Yi?",choices:["A golden bow","An elixir","A mooncake","A shield"],a:1,ex:"She gave him a special elixir that could grant immortality."},
    {type:"mcq",q:"Why did Changâ€™e swallow the elixir?",choices:["She was hungry","She wanted to be a goddess","She could not fight Peng Meng","She lost it"],a:2,ex:"She swallowed it because she could not fight Peng Meng."},
    {type:"cloze",q:"People celebrate by moon-gazing and eating ________.",a:"mooncakes",ex:"They celebrate by moon-gazing and eating mooncakes."},
    {type:"tf",q:"True or False: The elixir could grant immortality.",a:true,ex:"Trueâ€”The elixir granted immortality."}
  ];

  // ====== 3) æ’­æ”¾å™¨ & äº’å‹• ======
  const vid = document.getElementById('vid');
  const prog = document.getElementById('prog');
  const fileVideo = document.getElementById('fileVideo');
  const banner = document.getElementById('errorBanner');
  const prevBtn = document.getElementById('prev');
  const nextBtn = document.getElementById('next');
  const toggleBtn = document.getElementById('toggle');
  const replayBtn = document.getElementById('replay');
  const autoPauseBtn = document.getElementById('autoPause');
  const rate = document.getElementById('rate');
  const rateVal = document.getElementById('rateVal');
  const wholeLoopBtn = document.getElementById('wholeLoop');
  const abOnClickBtn = document.getElementById('abOnClick');
  const clearLoopBtn = document.getElementById('clearLoop');
  const tabSub = document.getElementById('tabSub');
  const tabQuiz = document.getElementById('tabQuiz');
  const toggleCompact = document.getElementById('toggleCompact');
  const list = document.getElementById('list');
  const nowEn = document.getElementById('nowEn');
  const nowZh = document.getElementById('nowZh');
  const nowVocab = document.getElementById('nowVocab');
  const nowBox = document.getElementById('now');
  const quizBox = document.getElementById('quizBox');
  const quizQ = document.getElementById('quizQ');
  const quizChoices = document.getElementById('quizChoices');
  const quizInput = document.getElementById('quizInput');
  const quizMsg = document.getElementById('quizMsg');
  const mainRight = document.getElementById('mainRight');

  let active=-1, autoPause=false, looping=false, wholeLoop=false, abOnClickEnabled=true, abIndex=-1;
  let compact=false, qIndex=0;

  function showBanner(){
    banner.style.display='block';
    banner.innerHTML='ğŸš© <b>æœªè‡ªå‹•è¼‰å…¥å½±ç‰‡</b><br>è«‹æŠŠå½±ç‰‡æ”¾åœ¨æ­¤é é¢åŒå±¤ï¼Œæª”å <code>story.mov</code> æˆ– <code>story.mp4</code>ã€‚<br>æˆ–æŒ‰<b>ã€Œé¸æ“‡æª”æ¡ˆã€</b> â†’ å¾ä½ çš„é›»è…¦æŒ‘é¸å½±ç‰‡ã€‚';
  }

  // å…ˆå˜—è©¦è‡ªå‹•è¼‰å…¥ story.mov / story.mp4ï¼ˆå«å¤§å°å¯«ï¼‰
  const candidates=["story.mov","story.MOV","Story.mov","STORY.MOV","story.mp4","story.MP4","Story.mp4","STORY.MP4"];
  let tried=0;
  (function tryNext(){
    if(tried>=candidates.length){ showBanner(); return; }
    const src=candidates[tried++]; vid.src=src;
    const ok=()=>{ banner.style.display='none'; cleanup(); };
    const bad=()=>{ cleanup(); tryNext(); };
    const cleanup=()=>{ vid.removeEventListener('loadedmetadata', ok); vid.removeEventListener('error', bad); };
    vid.addEventListener('loadedmetadata', ok, {once:true});
    vid.addEventListener('error', bad, {once:true});
  })();

  // æ‰‹å‹•é¸æª”
  fileVideo.addEventListener('change', e=>{
    const f=e.target.files?.[0]; if(!f) return;
    banner.style.display='none';
    vid.src=URL.createObjectURL(f); vid.load();
  });

  function toTime(t){ const m=String(Math.floor(t/60)).padStart(2,'0'); const s=String(Math.floor(t%60)).padStart(2,'0'); return m+':'+s; }

  // æ¸²æŸ“å­—å¹•åˆ—è¡¨
  function renderList(){
    list.innerHTML = CUES.map((c,i)=>`
      <div class="row" data-i="${i}">
        <div class="idx">${i+1}</div>
        <div class="time">${toTime(c.start)}</div>
        <div>
          <div class="enline">${c.en}</div>
          <div class="zhline">${c.zh}</div>
        </div>
      </div>`).join('');
    list.querySelectorAll('.row').forEach(el=>{
      el.addEventListener('click',()=>{
        const i=+el.dataset.i; goCue(i,true);
        if(abOnClickEnabled){ abIndex=i; looping=true; replayBtn.setAttribute('aria-pressed','true');}
      });
    });
  }
  renderList();

  // å³æ™‚å€å¡Š
  function updateNow(i){
    const c=CUES[i]; if(!c) return;
    nowEn.textContent=c.en; nowZh.textContent=c.zh;
    nowVocab.innerHTML=(c.vocab||[]).map(v=>`<span class="chip"><b>${v.w}</b> â€” ${v.m}</span>`).join('');
  }

  function goCue(i, play=false){
    i=Math.max(0,Math.min(CUES.length-1,i));
    active=i; updateNow(i);
    vid.currentTime=CUES[i].start+0.02; if(play) vid.play();
  }

  function setActiveRow(i){
    const prev = list.querySelector('.row.active'); if(prev) prev.classList.remove('active');
    const now = list.querySelector(`.row[data-i="${i}"]`);
    if(now){ now.classList.add('active'); now.scrollIntoView({block:'center', behavior:'smooth'}); }
  }

  vid.addEventListener('timeupdate',()=>{
    const t=vid.currentTime;
    const i=CUES.findIndex(c=>t>=c.start&&t<c.end);
    if(i!==-1 && i!==active){ active=i; updateNow(i); setActiveRow(i); }
    if(vid.duration) prog.style.width=`${(t/vid.duration)*100}%`;
    if(autoPause&&active!==-1&&t>=CUES[active].end) vid.pause();
    if(looping&&active!==-1&&t>=CUES[active].end){
      const idx=(abIndex>=0?abIndex:active); vid.currentTime=CUES[idx].start+0.02;
    }
    const lastEnd=CUES[CUES.length-1].end;
    if(wholeLoop&&t>=lastEnd){ active=0; updateNow(0); setActiveRow(0); vid.currentTime=CUES[0].start+0.02; if(vid.paused) vid.play(); }
  });

  // æ§åˆ¶åˆ—
  prevBtn.onclick=()=>goCue((active===-1?0:active-1),true);
  nextBtn.onclick=()=>goCue((active===-1?0:active+1),true);
  replayBtn.onclick=()=>{ if(active===-1)return; looping=!looping; abIndex=(looping?active:-1); replayBtn.setAttribute('aria-pressed',String(looping)); };
  autoPauseBtn.onclick=()=>{ autoPause=!autoPause; autoPauseBtn.setAttribute('aria-pressed',String(autoPause)); };
  toggleBtn.onclick=()=> vid.paused?vid.play():vid.pause();
  rate.oninput=()=>{ vid.playbackRate=+rate.value; rateVal.textContent=`${(+rate.value).toFixed(2)}Ã—`; };
  wholeLoopBtn.onclick=()=>{ wholeLoop=!wholeLoop; wholeLoopBtn.setAttribute('aria-pressed',String(wholeLoop)); };
  abOnClickBtn.onclick=()=>{ abOnClickEnabled=!abOnClickEnabled; abOnClickBtn.setAttribute('aria-pressed',String(abOnClickEnabled)); };
  clearLoopBtn.onclick=()=>{ looping=false; abIndex=-1; replayBtn.setAttribute('aria-pressed','false'); };

  // åˆ†é 
  tabSub.onclick=()=>{ tabSub.setAttribute('aria-pressed','true'); tabQuiz.setAttribute('aria-pressed','false'); list.classList.remove('hidden'); quizBox.classList.add('hidden'); nowBox.classList.remove('hidden'); };
  tabQuiz.onclick=()=>{ tabSub.setAttribute('aria-pressed','false'); tabQuiz.setAttribute('aria-pressed','true'); list.classList.add('hidden'); quizBox.classList.remove('hidden'); nowBox.classList.add('hidden'); renderQuiz(); };

  // ç·Šæ¹Šæ¨¡å¼
  toggleCompact.onclick=()=>{ 
    compact=!compact; toggleCompact.setAttribute('aria-pressed', String(compact));
    mainRight.classList.toggle('compact', compact);
  };

  // å°æ¸¬é©—
  function renderQuiz(){
    const q=QUIZ[qIndex]; quizMsg.textContent='';
    quizChoices.innerHTML=''; quizInput.classList.add('hidden');
    if(q.type==='mcq'){
      quizQ.textContent = `Q${qIndex+1}. ${q.q}`;
      q.choices.forEach((c,idx)=>{
        const b=document.createElement('button'); b.className='btn'; b.textContent=c; b.dataset.idx=idx;
        b.onclick=()=>{ [...quizChoices.children].forEach(x=>x.classList.remove('sel')); b.classList.add('sel'); b.dataset.sel='1'; };
        quizChoices.appendChild(b);
      });
    } else if(q.type==='cloze'){
      quizQ.textContent = `Q${qIndex+1}. ${q.q}`;
      quizInput.classList.remove('hidden'); quizInput.value=''; quizInput.focus();
    } else if(q.type==='tf'){
      quizQ.textContent = `Q${qIndex+1}. ${q.q}`;
      ['True','False'].forEach((label,idx)=>{
        const b=document.createElement('button'); b.className='btn'; b.textContent=label; b.dataset.val=String(idx===0);
        b.onclick=()=>{ [...quizChoices.children].forEach(x=>x.classList.remove('sel')); b.classList.add('sel'); };
        quizChoices.appendChild(b);
      });
    }
  }
  document.getElementById('quizCheck').onclick=()=>{
    const q=QUIZ[qIndex];
    let correct=false;
    if(q.type==='mcq'){
      const picked=[...quizChoices.children].find(x=>x.classList.contains('sel'));
      if(picked){ correct = Number(picked.dataset.idx)===q.a; }
    } else if(q.type==='cloze'){
      const val=(document.getElementById('quizInput').value||'').trim().toLowerCase();
      correct = val===String(q.a).toLowerCase();
    } else if(q.type==='tf'){
      const picked=[...quizChoices.children].find(x=>x.classList.contains('sel'));
      if(picked){ correct = (picked.dataset.val === String(q.a)); }
    }
    quizMsg.textContent = correct ? 'âœ”ï¸ æ­£ç¢ºï¼ ' + (q.ex||'') : 'âœ– å†æƒ³æƒ³ï½ ' + (q.ex?('æç¤ºï¼š'+q.ex):'');
  };
  document.getElementById('quizNext').onclick=()=>{ qIndex=(qIndex+1)%QUIZ.length; renderQuiz(); };

})();
</script>
</body>
</html>
